<!-- src/app/features/dashboard/components/notifications/notifications.component.html -->

<div class="notifications-container">
  <!-- En-tête des notifications -->
  <div class="notifications-header">
    <div class="header-title">
      <mat-icon>notifications</mat-icon>
      <h3>Notifications</h3>
      <span class="notification-badge" *ngIf="unreadCount > 0">{{ unreadCount }}</span>
    </div>
    
    <div class="header-actions">
      <button 
        mat-icon-button 
        (click)="onClearAll()" 
        [disabled]="notifications.length === 0"
        matTooltip="Marquer tout comme lu"
      >
        <mat-icon>done_all</mat-icon>
      </button>
      
      <button 
        mat-icon-button 
        [matMenuTriggerFor]="settingsMenu"
        matTooltip="Paramètres"
      >
        <mat-icon>settings</mat-icon>
      </button>
    </div>
  </div>

  <!-- Menu des paramètres -->
  <mat-menu #settingsMenu="matMenu">
    <div class="settings-menu">
      <h4>Paramètres de notification</h4>
      <div class="setting-item">
        <mat-checkbox [(ngModel)]="settings.showTaskReminders">
          Rappels de tâches
        </mat-checkbox>
      </div>
      <div class="setting-item">
        <mat-checkbox [(ngModel)]="settings.showDeadlineAlerts">
          Alertes d'échéances
        </mat-checkbox>
      </div>
      <div class="setting-item">
        <mat-checkbox [(ngModel)]="settings.showTeamUpdates">
          Mises à jour équipe
        </mat-checkbox>
      </div>
    </div>
  </mat-menu>

  <!-- Liste des notifications -->
  <div class="notifications-list" *ngIf="displayedNotifications.length > 0; else noNotifications">
    <div 
      class="notification-item" 
      *ngFor="let notification of displayedNotifications; trackBy: trackByNotificationId"
      [ngClass]="getNotificationClasses(notification)"
      (click)="onNotificationClick(notification)"
    >
      <!-- Icône et indicateur -->
      <div class="notification-icon">
        <mat-icon [ngClass]="getNotificationColor(notification.type)">
          {{ getNotificationIcon(notification.type) }}
        </mat-icon>
        <div class="unread-dot" *ngIf="!notification.read"></div>
      </div>

      <!-- Contenu -->
      <div class="notification-content">
        <div class="notification-header">
          <h4 class="notification-title">{{ notification.title }}</h4>
          <span class="notification-time">{{ formatTime(notification.timestamp) }}</span>
        </div>
        
        <p class="notification-message">{{ notification.message }}</p>
        
        <!-- Actions contextuelles -->
        <div class="notification-actions" *ngIf="notification.actionUrl">
          <button 
            mat-stroked-button 
            size="small" 
            (click)="onActionClick($event, notification)"
            class="action-btn"
          >
            <mat-icon>open_in_new</mat-icon>
            Voir détails
          </button>
        </div>
      </div>

      <!-- Bouton marquer comme lu -->
      <div class="notification-controls">
        <button 
          mat-icon-button 
          *ngIf="!notification.read"
          (click)="onMarkAsRead($event, notification.id)"
          matTooltip="Marquer comme lu"
          class="mark-read-btn"
        >
          <mat-icon>check</mat-icon>
        </button>
        
        <button 
          mat-icon-button 
          (click)="onDismiss($event, notification.id)"
          matTooltip="Masquer"
          class="dismiss-btn"
        >
          <mat-icon>close</mat-icon>
        </button>
      </div>

      <!-- Barre de priorité -->
      <div class="priority-bar" [ngClass]="'priority-' + notification.type"></div>
    </div>

    <!-- Bouton Voir plus/moins -->
    <div class="toggle-view" *ngIf="notifications.length > 5">
      <button mat-stroked-button (click)="toggleShowAll()" class="toggle-btn">
        <mat-icon>{{ showAll ? 'expand_less' : 'expand_more' }}</mat-icon>
        {{ showAll ? 'Voir moins' : 'Voir toutes (' + notifications.length + ')' }}
      </button>
    </div>
  </div>

  <!-- État vide -->
  <ng-template #noNotifications>
    <div class="empty-state">
      <mat-icon>notifications_off</mat-icon>
      <h4>Aucune notification</h4>
      <p>Vous êtes à jour ! Les nouvelles notifications apparaîtront ici.</p>
    </div>
  </ng-template>

  <!-- Indicateur de chargement -->
  <div class="loading-indicator" *ngIf="loading">
    <mat-progress-bar mode="indeterminate"></mat-progress-bar>
    <p>Chargement des notifications...</p>
  </div>
</div>

<!-- Notifications Toast (pour les nouvelles notifications) -->
<div class="toast-container" *ngIf="newNotifications.length > 0">
  <div 
    class="notification-toast" 
    *ngFor="let toast of newNotifications; trackBy: trackByNotificationId"
    [ngClass]="getNotificationColor(toast.type)"
    [@slideIn]
  >
    <mat-icon>{{ getNotificationIcon(toast.type) }}</mat-icon>
    <div class="toast-content">
      <strong>{{ toast.title }}</strong>
      <p>{{ toast.message }}</p>
    </div>
    <button mat-icon-button (click)="dismissToast(toast.id)">
      <mat-icon>close</mat-icon>
    </button>
  </div>
</div>